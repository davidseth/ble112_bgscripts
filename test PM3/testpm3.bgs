#Demo script to enter PM3 on BLE112
#Simon Taylor, simon.taylor@avnet-embedded.eu (Distributors for Bluegiga)
event system_boot(major ,minor ,patch ,build ,ll_version ,protocol_version ,hw )
	call gap_set_mode(0,0)
	#Allow pairing
	call sm_set_bondable_mode(1)
	call hardware_io_port_config_irq(0, 1, 0) #enable IRQ on I/O port 0:0
end

event connection_disconnected(handle,result)
	#in case if disconnect, return to advertisement mode
    call gap_set_mode(gap_general_discoverable,gap_undirected_connectable)
end

event hardware_io_port_status(timestamp, port, irq, state)
	call gap_set_adv_parameters(1600, 1600, 7)
	call gap_set_mode(gap_general_discoverable,gap_undirected_connectable)
	call hardware_set_soft_timer(1920000, 0, 1)	#60 seconds
end

event hardware_soft_timer(handle)
	call gap_set_mode(0, 0)	#switch off advertising
end